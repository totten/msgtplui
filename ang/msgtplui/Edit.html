<div id="bootstrap-theme">

  <div crm-ui-debug="$ctrl"></div>

  <ng-form name="edit_form">

    <div class="form-group">
      <label for="msgtpl_title">
        {{:: ts('Message Title') }} <span class="crm-marker">*</span>
      </label>
      <input ng-model="$ctrl.records.main.msg_title" class="form-control" id="msgtpl_title" required title="{{:: ts('Required') }}" ng-disabled="!!$ctrl.records.main.workflow_name" />
      <p class="help-block">{{:: ts('Descriptive title of the message - used for template selection') }}</p>
    </div>

    <div class="form-group" ng-if="$ctrl.lang">
      <label for="msgtpl_language">
        {{:: ts('Locale') }} <span class="crm-marker">*</span>
      </label>
      <input ng-model="$ctrl.locales[$ctrl.lang]" class="form-control" id="msgtpl_language" required title="{{:: ts('Required') }}" ng-disabled="true" />
      <!-- TODO: Pretty name -->
    </div>

    <a name="msgtplui-tabs"></a>
    <div class="panel panel-info">
<!--    <div class="panel" ng-class="{'panel-info': $ctrl.tab === 'original', 'panel-warning': $ctrl.tab === 'txDraft', 'panel-success': $ctrl.tab.match('main|txActive')}">-->
      <ul class="panel-heading nav nav-pills">
        <li role="presentation" class="navitem" ng-class="{active: $ctrl.tab == 'main'}" ng-if="!$ctrl.lang">
          <a class="nav-link text-success" ng-click="$ctrl.tab = 'main'">
            <span crm-icon="fa-file"></span>
            {{::ts('Current')}}
          </a>
        </li>
        <li role="presentation" class="navitem" ng-class="{active: $ctrl.tab == 'txActive'}" ng-if="!!$ctrl.lang">
          <a class="nav-link text-success" ng-click="$ctrl.tab = 'txActive'">
            <span crm-icon="fa-file"></span>
            {{::ts('Current')}}
          </a>
        </li>
        <li role="presentation" class="navitem" ng-class="{active: $ctrl.tab == 'txDraft'}" ng-if="$ctrl.hasDraft()">
          <a class="nav-link text-warning" ng-click="$ctrl.tab = 'txDraft'">
            <span crm-icon="fa-file"></span>
            {{::ts('Draft')}}
          </a>
        </li>
        <li role="presentation" class="navitem" ng-class="{active: $ctrl.tab == 'original'}">
          <a class="nav-link text-default" ng-click="$ctrl.tab = 'original'">
            <span crm-icon="fa-file"></span>
            {{::ts('Original')}}
          </a>
        </li>
      </ul>
      <div class="panel-body">
        <msgtplui-edit-content options="{record: $ctrl.records[$ctrl.tab], tokenList: $ctrl.tokenList, disabled: true}" ng-if="$ctrl.tab==='original'"></msgtplui-edit-content>
        <msgtplui-edit-content options="{record: $ctrl.records[$ctrl.tab], tokenList: $ctrl.tokenList}" ng-if="$ctrl.tab!=='original'"></msgtplui-edit-content>
        <div class="text-center">
          <div class="btn-group">
            <button type="button" class="btn btn-success" ng-if="$ctrl.tab.match('txActive|original') && !$ctrl.hasDraft()" ng-click="$ctrl.createDraft($ctrl.records[$ctrl.tab])"><i class="fa fa-clone"/> {{ts('Create draft')}}</button>
            <button type="button" class="btn btn-warning" ng-if="$ctrl.tab.match('txActive|original') && $ctrl.hasDraft()" crm-confirm="{title: ts('Create draft?'), message: ts('There is already an existing draft. If you continue, it will be reset as a new draft.')}" on-yes="$ctrl.createDraft($ctrl.records[$ctrl.tab])"><i class="fa fa-clone"/> {{ts('Create draft')}}</button>
            <button type="button" class="btn btn-success" ng-if="$ctrl.tab === 'txDraft'" crm-confirm="{title: ts('Activate draft?'), message: ts('Are you sure you want to activate this draft?')}" on-yes="$ctrl.activateDraft()"><i class="fa fa-rocket"/> {{ts('Activate draft')}}</button>
            <button type="button" class="btn btn-danger" ng-if="$ctrl.tab === 'txDraft'" crm-confirm="{type: 'delete', obj: {}, title: ts('Delete draft?'), message: ts('Are you sure you want to delete this draft?')}" on-yes="$ctrl.deleteDraft()"><i class="fa fa-trash"/> {{ts('Delete draft')}}</button>
          </div>
        </div>
      </div>
    </div>

    <div class="btn-group pull-right">
      <button type="button" class="btn btn-primary" ng-click="$ctrl.save()">
        <i class="fa fa-check"/> {{ ts('Save') }}
      </button>
      <button type="button" class="btn btn-primary" ng-click="$ctrl.save().then($ctrl.cancel)">
        <i class="fa fa-check-circle"/> {{ ts('Save and Done') }}
      </button>
      <button type="button" class="btn btn-primary" ng-click="$ctrl.cancel()">
        <i class="fa fa-times"/> {{ ts('Cancel') }}
      </button>
      <button type="button" class="btn btn-danger" crm-confirm="{type: 'delete', obj: {}, title: ts('Delete translation?'), message: ts('Are you sure want to delete this translation (%1)? This will remove any current and draft versions.', {1: $ctrl.lang})}" on-yes="$ctrl.delete()" ng-if="!!$ctrl.lang">
        <i class="fa fa-trash"/> {{ ts('Delete') }}
      </button>
    </div>

    <div class="clearfix"></div>

  </ng-form>

</div>
